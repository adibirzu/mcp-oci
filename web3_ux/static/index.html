<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OCI MCP Web3 UX</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:false});</script>
</head>
<body>
  <header>
    <h1>OCI MCP Web3 UX</h1>
    <nav>
      <a href="#overview">Overview</a>
      <a href="#discovery">Discovery</a>
      <a href="#capacity">Capacity</a>
      <a href="#costs">Costs</a>
      <a href="#observability">Observability</a>
      <a href="#agents">Agents</a>
      <a href="#kbs">KBs</a>
      <a href="#endpoints">Endpoints</a>
      <a href="#db">DB</a>
      <a href="#relations">Relations</a>
      <a href="#finops">FinOps AI</a>
      <a href="#chat">Chat</a>
    </nav>
  </header>

  <main>
    <div id="preflight" class="panel" style="border-color:#e60000; display:none;">
      <strong>Setup required:</strong> COMPARTMENT_OCID is not set. Enter a compartment OCID in the Discovery/Capacity inputs or set COMPARTMENT_OCID in your .env.
    </div>
    <section id="overview" class="panel">
      <h2>MCP Server Capabilities</h2>
      <p>
        This Web3 UI connects to the OCI MCP app and surfaces dynamic discovery,
        ShowOCI/ShowUsage outputs, capacity reports, costs, and relationships –
        all styled in Oracle Redwood-inspired colors.
      </p>
      <ul>
        <li>Consolidated Observability server with Log Analytics tools</li>
        <li>Name→OCID registry and per-service caches for low token usage</li>
        <li>Inventory discovery: VCNs, Subnets, NSGs, Instances, Load Balancers, Functions, Streams</li>
        <li>Cost and usage insights via Usage API</li>
      </ul>
    </section>

    <section id="discovery" class="panel">
      <h2>Discovery</h2>
      <div class="controls">
        <input id="compartment" placeholder="Compartment OCID (optional)" />
        <button id="discoveryBtn" onclick="loadDiscovery()">Load Discovery</button>
      </div>
      <div id="discHint" class="muted"></div>
      <div id="discoveryTables"></div>
    </section>

    <section id="capacity" class="panel">
      <h2>Capacity</h2>
      <div class="controls">
        <input id="capCompartment" placeholder="Compartment OCID (optional)" />
        <button id="capacityBtn" onclick="loadCapacity()">Load Capacity Report</button>
      </div>
      <div id="capHint" class="muted"></div>
      <pre id="capacityOut" class="code"></pre>
    </section>

    <section id="costs" class="panel">
      <h2>Costs & Usage</h2>
      <div class="controls">
        <select id="timeWindow">
          <option value="7d">7d</option>
          <option value="30d">30d</option>
        </select>
        <button onclick="loadCosts()">Get Cost Summary</button>
        <button onclick="loadShowOCI()">ShowOCI</button>
        <button onclick="loadShowUsage()">ShowUsage</button>
      </div>
      <pre id="costsOut" class="code"></pre>
      <pre id="showOCIOut" class="code"></pre>
      <pre id="showUsageOut" class="code"></pre>
    </section>

    <section id="db" class="panel">
      <h2>Autonomous DB</h2>
      <div class="controls">
        <button onclick="loadDbSummary()">DB Summary</button>
        <select id="dbTable">
          <option value="VCNS">VCNS</option>
          <option value="SUBNETS">SUBNETS</option>
          <option value="INSTANCES">INSTANCES</option>
          <option value="LOAD_BALANCERS">LOAD_BALANCERS</option>
          <option value="FUNCTIONS_APPS">FUNCTIONS_APPS</option>
          <option value="STREAMS">STREAMS</option>
          <option value="COSTS_SUMMARY">COSTS_SUMMARY</option>
          <option value="CAPACITY_REPORT">CAPACITY_REPORT</option>
        </select>
        <button onclick="loadDbTable()">Load Table</button>
        <button onclick="syncDb()">Sync Now</button>
      </div>
      <pre id="dbSummary" class="code"></pre>
      <div id="dbTableView"></div>
      <pre id="dbSyncOut" class="code"></pre>
      <div class="controls">
        <button onclick="loadCostTrend()">Load Cost Trend</button>
        <button onclick="loadCapacityTrend()">Load Capacity Trend</button>
      </div>
      <pre id="dbChartsOut" class="code"></pre>
    </section>

    <section id="observability" class="panel">
      <h2>Observability (Log Analytics Quick Checks)</h2>
      <div class="controls">
        <input id="obsCompartment" placeholder="Compartment OCID (optional)" />
        <select id="obsTimeRange">
          <option value="24h" selected>24h</option>
          <option value="7d">7d</option>
        </select>
        <input id="obsSample" type="number" min="1" max="50" value="5" />
        <button id="obsQuickBtn" onclick="runQuickChecks()">Run Quick Checks</button>
      </div>
      <div id="obsHint" class="muted"></div>
      <div id="obsQuickCards"></div>
      <pre id="obsQuickOut" class="code"></pre>
    </section>

    <section id="agents" class="panel">
      <h2>OCI Generative AI Agents</h2>
      <div class="controls">
        <input id="agentName" placeholder="Name" />
        <input id="agentType" placeholder="Type (e.g., RAG,CHAT)" />
        <input id="agentModel" placeholder="Model (e.g., cohere.command-r-plus)" />
        <button onclick="createAgent()">Create Agent</button>
        <button onclick="loadAgents()">Refresh</button>
      </div>
      <div id="agentsHint" class="muted">Configured via GAI_ADMIN_ENDPOINT/GAI_AGENT_ENDPOINT in .env</div>
      <div id="agentsList"></div>
      <pre id="agentsOut" class="code"></pre>
    </section>

    <section id="kbs" class="panel">
      <h2>Knowledge Bases</h2>
      <div class="controls">
        <input id="kbName" placeholder="Display Name" />
        <input id="kbDesc" placeholder="Description (optional)" />
        <button onclick="createKB()">Create KB</button>
        <button onclick="loadKBs()">Refresh</button>
      </div>
      <div id="kbList"></div>
      <div class="controls">
        <input id="dsKbId" placeholder="KB OCID for Data Source" />
        <input id="dsName" placeholder="DS Display Name" />
        <input id="dsBucketNs" placeholder="OS Namespace" />
        <input id="dsBucket" placeholder="OS Bucket" />
        <input id="dsPrefix" placeholder="OS Prefix (e.g., docs/)" />
        <button onclick="createDataSource()">Create Data Source</button>
        <button onclick="loadDataSources()">List Data Sources</button>
      </div>
      <div id="dsList"></div>
      <pre id="kbOut" class="code"></pre>
    </section>

    <section id="endpoints" class="panel">
      <h2>Agent Endpoints</h2>
      <div class="controls">
        <input id="epName" placeholder="Display Name" />
        <input id="epAgentId" placeholder="Agent OCID" />
        <input id="epDesc" placeholder="Description (optional)" />
        <label><input type="checkbox" id="epTrace" /> Trace</label>
        <label><input type="checkbox" id="epCitation" /> Citation</label>
        <button onclick="createEndpoint()">Create Endpoint</button>
        <button onclick="loadEndpoints()">Refresh</button>
      </div>
      <div id="epList"></div>
      <pre id="epOut" class="code"></pre>
    </section>

    <section id="relations" class="panel">
      <h2>Relations (Sample)</h2>
      <div class="controls">
        <button onclick="loadRelations()">Load Relations Graph</button>
      </div>
      <div id="relationsGraph" class="mermaid"></div>
      <p>For the classic UX relations page see http://localhost:8000/.</p>
    </section>

    <section id="finops" class="panel">
      <h2>FinOps AI</h2>
      <div class="controls">
        <select id="finopsWindow">
          <option value="30d">30d</option>
          <option value="7d">7d</option>
          <option value="60d">60d</option>
        </select>
        <input id="finopsThreshold" type="number" step="0.1" value="3.0" />
        <input id="finopsCompartment" placeholder="Compartment OCID (optional)" />
        <button onclick="analyzeFinops()">Analyze</button>
      </div>
      <pre id="finopsOut" class="code"></pre>
    </section>

    <section id="chat" class="panel">
      <h2>OCI Generative AI Agents</h2>
      <p>Configure GAI_AGENT_ENDPOINT to proxy chat to OCI Generative AI Agents. This UI provides a simple chat console.</p>
      <div id="chatBox">
        <div id="chatLog"></div>
        <div class="controls">
          <input id="chatInput" placeholder="Ask the agent..." onkeydown="if(event.key==='Enter'){sendChat()}" />
          <button onclick="sendChat()">Send</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <small>OCI MCP Web3 UX • Oracle Redwood inspired</small>
  </footer>

  <script src="/static/app.js"></script>
  </body>
  </html>
